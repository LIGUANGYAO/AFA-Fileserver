/**
 * Created by zhengshufa on 17/8/2.
 */
if("undefined"==typeof webupload_domain){var webupload_domain="http://fs.afacms.com"}if("undefined"==typeof $.webupload_path){$.extend({webupload_path:webupload_domain+"/static/webuploader/",webupload_include:function(d){var a=typeof d=="string"?[d]:d;for(var e=0;e<a.length;e++){var b=a[e].replace(/^s+$/g,"");console.log(b);var g=b.split(".");var c=g[g.length-1].toLowerCase();var j=c=="css";var k=j?"link":"script";var f=j?" type='text/css' rel='stylesheet' ":" language='javascript' type='text/javascript' ";var h=(j?"href":"src")+"='"+$.webupload_path+b+"'";if($(k+"["+h+"]").length==0){document.write("<"+k+f+h+"></"+k+">")}}}});$.webupload_include(["webuploader.css","demo.css","webuploader.js"])}$.getScript();if("undefined"==typeof webupload_flash){var webupload_flash=$.webupload_path+"Uploader.swf"}if("undefined"==typeof webupload_fileserver){var webupload_fileserver=webupload_domain+"/fileServer/upload?token="}if("undefined"==typeof webupload_fileVal){var webupload_fileVal="myfile"}var webupload_file_config={auto:false,swf:webupload_flash,server:webupload_fileserver,pick:".uploader-container .pick",accept:{title:"Files",extensions:"txt,pdf,ppt,pptx,mp4,mp3,avi,doc,docx,jpg,png,gif,xls,xlsx,zip,gz,rar,amr,m4a",},formData:{"fileVal":webupload_fileVal},fileVal:webupload_fileVal,fileNumLimit:1,fileSingleSizeLimit:1024*1024*1024,chunked:true,chunkSize:1*1024*1024,chunkRetry:2,resize:false};var uploadFileArr=[];function webuploadFiles(a){var c=$.extend({},webupload_file_config,a);c.server=webupload_file_config.server+a.token;var b=WebUploader.create(c);b.on("beforeFileQueued",function(d){if(c.fileNumLimit==1){b.reset()}});b.on("fileQueued",function(d){$li='<div id="'+d.id+'" class="item">'+'<h4 class="info">'+d.name+"</h4>"+'<p class="state">等待上传...</p>'+"</div>";if(c.fileNumLimit==1){$(".uploader-list",d.source._refer.context.parentNode.parentNode).html($li)}else{$(".uploader-list",d.source._refer.context.parentNode.parentNode).append($li)}console.log(d)});b.on("uploadProgress",function(f,d){var g=$("#"+f.id),e=g.find(".progress .progress-bar");if(!e.length){e=$('<div class="progress progress-striped active">'+'<div class="progress-bar" role="progressbar" style="width: 0%">'+"</div>"+"</div>").appendTo(g).find(".progress-bar")}g.find("p.state").text("上传中");e.css("width",d*100+"%")});b.on("uploadSuccess",function(f,e){if(e.errNum!=0){$("#"+f.id).find("p.state").text(e.errMsg);return}$("#"+f.id).find("p.state").text("已上传");var h="input[name='"+c.fieldname+"']";var d=$(h,$("#"+f.id).parent().parent());if(c.fileNumLimit==1){d.val(f.name+","+e.retData.url+","+e.retData.size)}else{var g=d.val();if(g){d.val(g+";"+f.name+","+e.retData.url+","+e.retData.size)}else{d.val(f.name+","+e.retData.url+","+e.retData.size)}}});b.on("uploadError",function(d){$("#"+d.id).find("p.state").text("上传出错")});b.on("uploadComplete",function(e,d){$("#"+e.id).find(".progress").fadeOut()});$("#uploadbtn"+c.fieldname).click(function(){b.upload()})}function webupload_fileinit(a){var c='<div class="uploader-container">'+'<div class="uploader-list"></div>'+'<div class="btns">'+'<div class="pick" id="pick'+a.fieldname+'">选择文件</div>'+'<div class="btn btn-default" style="float: left" id="uploadbtn'+a.fieldname+'">开始上传</div>'+"</div>"+'<div class="clear" style="clear: both;"></div>'+'<input type="hidden" name="'+a.fieldname+'" value="" autocomplete="off" class="inputfile" />'+"</div>";if("undefined"!=typeof a.el){$(a.el).html(c)}else{document.writeln(c)}for(var b in uploadFileArr){if(uploadFileArr[b].fieldname==a.fieldname){return}}uploadFileArr.push($.extend({},{pick:"#pick"+a.fieldname},a))}$(function(){for(var a in uploadFileArr){webuploadFiles(uploadFileArr[a])}});