/**
 * Created by zhengshufa on 17/8/2.
 */
if("undefined"==typeof webupload_domain){var webupload_domain="http://fs.afacms.com"}if("undefined"==typeof $.webupload_path){$.extend({webupload_path:webupload_domain+"/static/webuploader/",webupload_include:function(d){var a=typeof d=="string"?[d]:d;for(var e=0;e<a.length;e++){var b=a[e].replace(/^s+$/g,"");console.log(b);var g=b.split(".");var c=g[g.length-1].toLowerCase();var j=c=="css";var k=j?"link":"script";var f=j?" type='text/css' rel='stylesheet' ":" language='javascript' type='text/javascript' ";var h=(j?"href":"src")+"='"+$.webupload_path+b+"'";if($(k+"["+h+"]").length==0){document.write("<"+k+f+h+"></"+k+">")}}}});$.webupload_include(["webuploader.css","demo.css","webuploader.js"])}if("undefined"==typeof webupload_flash){var webupload_flash=$.webupload_path+"Uploader.swf"}if("undefined"==typeof webupload_imgserver){var webupload_imgserver=webupload_domain+"/fileServer/uploadPic?token="}if("undefined"==typeof webupload_fileVal){var webupload_fileVal="myfile"}if("undefined"==typeof webupload_sizearr){var webupload_sizearr=JSON.stringify([[1600,1600],[600,600]])}var webupload_img_config={auto:true,swf:webupload_flash,server:webupload_imgserver,pick:".uploader-container .pick",accept:{title:"Images",extensions:"gif,jpg,jpeg,png",mimeTypes:"image/*"},formData:{"sizearr":webupload_sizearr,"fileVal":webupload_fileVal},fileVal:webupload_fileVal,thumb:{width:120,height:120},fileNumLimit:1,fileSingleSizeLimit:5*1024*1024,};var uploadImgArr=[];function webuploadImgs(a){var c=$.extend({},webupload_img_config,a);c.server=webupload_img_config.server+a.token;c.formData.sizearr=a.sizearr;console.log(c);var b=WebUploader.create(c);b.on("beforeFileQueued",function(d){if(c.fileNumLimit==1){b.reset()}});b.on("fileQueued",function(e){var f=$('<div id="'+e.id+'" class="file-item thumbnail">'+"<img>"+'<div class="info">'+e.name+"</div>"+"</div>"),d=f.find("img");if(c.fileNumLimit==1){$(".uploader-list",e.source._refer.context.parentNode).html(f)}else{$(".uploader-list",e.source._refer.context.parentNode).append(f)}b.makeThumb(e,function(g,h){if(g){d.replaceWith("<span>不能预览</span>");return}d.attr("src",h)},c.thumb.width,c.thumb.height)});b.on("uploadProgress",function(f,d){var g=$("#"+f.id),e=g.find(".progress span");if(!e.length){e=$('<p class="progress"><span></span></p>').appendTo(g).find("span")}e.css("width",d*100+"%")});b.on("uploadSuccess",function(f,e){$("#"+f.id).addClass("upload-state-done");var h="input[name='"+c.fieldname+"']";var d=$(h,$("#"+f.id).parent().parent());if(c.fileNumLimit==1){d.val(f.name+","+e.retData.url)}else{var g=d.val();if(g){d.val(g+";"+f.name+","+e.retData.url)}else{d.val(f.name+","+e.retData.url)}}});b.on("uploadError",function(e){var f=$("#"+e.id),d=f.find("div.error");if(!d.length){d=$('<div class="error"></div>').appendTo(f)}d.text("上传失败")});b.on("uploadComplete",function(d){$("#"+d.id).find(".progress").remove();b.refresh()})}function webupload_imginit(a){var c='<div class="uploader-container">'+'<div class="uploader-list"></div>'+'<div class="pick" id="pick'+a.fieldname+'">选择图片</div>'+'<input type="hidden" name="'+a.fieldname+'" value="" autocomplete="off" class="inputfile" />'+"</div>";if("undefined"!=typeof a.el){$(a.el).html(c)}else{document.writeln(c)}for(var b in uploadImgArr){if(uploadImgArr[b].fieldname==a.fieldname){return}}uploadImgArr.push($.extend({},{pick:"#pick"+a.fieldname},a))}$(function(){for(var a in uploadImgArr){webuploadImgs(uploadImgArr[a])}});